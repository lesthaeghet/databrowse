<xsl:strip-space elements="*"/>
<xsl:template xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:chx="http://thermal.cnde.iastate.edu/checklist" match="html:html" mode="full">
    <xsl:apply-templates select="html:head" mode="full"/>
    <script type="text/javascript" DEFER='true'>
        <![CDATA[
            // Error Saving Callback Function
            function saveErrorCallback (jqXHR, textStatus, errorThrown) {
                alert("Failure: " + errorThrown)
            }

            function saveSuccessCallback (data, textStatus, jqXHR) {
                alert("Success: " + data)
            }
            
            savexml = function() {
                // Everything Here is the Same as in chx2html.xsl /////////
                /* first filter checkitemnum attributes from <checkitem> tags */
                var processor=new XSLTProcessor();
                processor.importStylesheet(filternums_xsl_parsed);
                //filteredchecklistxml=processor.transformToFragment(checklistxml,document);
                var filteredchecklistxml=processor.transformToDocument(checklistxml);

                // New Saving Components //////////////////////////////////
                $.ajax({
                    async: 'false',
                    cache: 'false',
                    contentType: 'text/xml',
                    data: filteredchecklistxml,
                    datatype: 'xml',
                    error: saveErrorCallback,
                    processData: false,
                    success: saveSuccessCallback,
                    type: 'POST',
                    url: 'https://thermal.cnde.iastate.edu/bugtest.wsgi'
                    });

                }

        ]]>
    </script>
    <xsl:apply-templates select="html:body" mode="full"/>
</xsl:template>
<xsl:template xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:chx="http://thermal.cnde.iastate.edu/checklist" match="@*|*|text()|processing-instruction()|comment()" mode="copy"><xsl:copy><xsl:apply-templates select="@*|*|text()|processing-instruction()|comment()" mode="copy"/></xsl:copy></xsl:template>
<xsl:template xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:chx="http://thermal.cnde.iastate.edu/checklist" match="html:img" mode="copy">
    <img>
        <xsl:attribute name="src"><xsl:value-of select="@src"/>?content_mode=raw</xsl:attribute>
    </img>
</xsl:template>
<xsl:template xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:chx="http://thermal.cnde.iastate.edu/checklist" match="html:head" mode="full">
    <xsl:apply-templates mode="copy"/>
</xsl:template>
<xsl:template xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:chx="http://thermal.cnde.iastate.edu/checklist" match="html:body" mode="full">
    <xsl:apply-templates mode="copy"/>
</xsl:template>